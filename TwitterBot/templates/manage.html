<div class="row">
    <div class="col-md-12 mb-3">
        <h2 class="mb-3">Add new account</h2>
        <p class="mb-3">
            Add a new Twitter account to allow other users to request to post to the account, pending your approval.
            Nothing will be posted to this account without your consent, and you can remove the
            account at any time either in this app or via your Twitter application permissions. If you are
            currently logged into Twitter, that account will automatically be authenticated.
            Log out of Twitter or sign into a different account to add a different handle.
        </p>

        <button class="btn btn-dark" ng-click="twitterSignIn()">
            <i class="fab fa-twitter fa-md twitter"></i> Sign in with Twitter
        </button>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-3">
        <h2 class="mb-3">Your Twitter accounts</h2>
        <p class="mb-3">
            These are your current Twitter accounts registered within this application. Click <b>Settings</b> next to
            each handle to edit account settings. Configurable settings include enabling private account status, and account deletion.
            If you designate an account as private, it only appears in your list of handles when composing a tweet.
        </p>

        <div ng-if="isLoadingHandles" class="d-flex p-3 align-items-center border border-common rounded">
            <strong>Loading twitter accounts...</strong>
            <div class="spinner-border text-primary ml-auto" role="status" aria-hidden="true"></div>
        </div>
        <div class="list-group">
            <div ng-repeat="x in handles" class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between align-items-center" ng-hide="x.settings">
                    <h5 class="my-auto handles">{{x.handle}}</h5>
                    <button class="btn btn-primary my-auto" ng-click="expandSettings($index)">
                        Settings &nbsp; <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="settings-pane mt-3 card" ng-show="x.settings">
                    <div class="card-body">
                        <div class="card-title">
                            <h5 class="my-auto handles">{{x.handle}}</h5>
                        </div>
                        <div class="d-flex w-100 justify-content-between mb-3">
                            <p class="my-auto">Delete account</p>
                            <button type="button" class="btn btn-danger my-auto" data-handle="{{x.handle}}" data-index="{{$index}}"
                                    data-toggle="modal" data-target="#delete">
                                Delete &nbsp; <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>

                        <div class="d-flex w-100 justify-content-between mb-3">
                            <p class="my-auto">Enable automatic <span class="twitter">@mention</span> retweets <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" data-html="true"
                                                                                                                  title="When toggled on, any tweet mentioning <span class='twitter'>{{x.handle}}</span> will be added to your queue. Approving will automatically retweet the mention."></i></p>
                            <i class="fas fa-toggle-on fa-2x" ng-click="disableAutoTweets(x.handle, $index)" ng-show="x.retweet" style="vertical-align: middle;"></i>
                            <i class="fas fa-toggle-off fa-2x" ng-click="enableAutoTweets(x.handle, $index)" ng-show="!x.retweet" style="vertical-align: middle;"></i>
                        </div>

                        <div class="d-flex w-100 justify-content-between mb-3">
                            <p class="my-auto">Private account <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" data-html="true" title="When toggled on, this account is <b>hidden</b> to other users within this application. This is commonly used for <i>personal</i> accounts."></i></p>
                            <i class="fas fa-toggle-on fa-2x" ng-click="togglePrivateAccount(x.handle, $index, false)" ng-show="x.isPrivate" style="vertical-align: middle;"></i>
                            <i class="fas fa-toggle-off fa-2x" ng-click="togglePrivateAccount(x.handle, $index, true)" ng-show="!x.isPrivate" style="vertical-align: middle;"></i>
                        </div>                        
                    </div>
                    <div class="card-footer">
                        <div class="d-flex justify-content-end collapse">
                            <button class="btn btn-secondary" ng-click="hideSettings($index)">
                                Done &nbsp; <i class="fas fa-chevron-up"></i>
                            </button>                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-3">
        <h2 class="mb-3">Your Tweet queue</h2>
        <p class="mb-3">
            These are all current Tweets that users have requested to post to any of your configured Twitter accounts.
            Approve the request to post the Tweet at the scheduled time. You can edit the content of a tweet, and cancel your approval
            up until the scheduled post time. The <i class="fab fa-twitter-square fa-lg twitter"></i> indicates
            that the Tweet has been posted, and no further edits can be made.
        </p>

        <div ng-if="isLoadingQueue" class="d-flex p-3 align-items-center border border-common rounded">
            <strong>Loading tweet queue...</strong>
            <div class="spinner-border text-success ml-auto" role="status" aria-hidden="true"></div>
        </div>
        <div class="list-group scroll-group">
            <div ng-repeat="tweet in tweetQueue" class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <h5 class="handles">{{tweet.TwitterHandle}}</h5>
                    <small>{{tweet.CreatedTime}}</small>
                </div>
                <p class="mb-1 wrapped">{{tweet.StatusBody}}</p>
                <div class="d-flex w-100 justify-content-between mt-2 mb-3">
                    <span>
                        <i class="far fa-clock fa-sm" style="vertical-align: middle;"></i>
                        <small class="my-auto">{{tweet.ScheduledStatusTime}}</small>
                    </span>
                    <span>
                        <i class="fas fa-user fa-sm" style="vertical-align: middle;"></i>
                        <small class="my-auto">{{tweet.TweetUser}}</small>
                    </span>
                </div>
                <div class="d-flex w-100 justify-content-between mt-3" ng-hide="tweet.EditPaneExpanded || tweet.IsPostedByWebJob">
                    <span>
                        <button ng-show="!tweet.IsApprovedByHandle" type="button" ng-class="{'btn btn-primary btn-sm': tweet.RetweetNum==0, 'btn btn-warning btn-sm': tweet.RetweetNum>0}" ng-click="approveTweet(tweet.Id, $index)">{{tweet.RetweetNum == 0 ? 'Approve' : 'Approve and retweet'}}</button>
                        <button ng-show="tweet.IsApprovedByHandle" type="button" class="btn btn-primary btn-sm" ng-click="cancelTweet(tweet.Id, $index)">Cancel</button>

                        <i ng-show="!tweet.IsApprovedByHandle" class="fas fa-times-circle fa-lg" style="vertical-align: middle;"></i>
                        <i ng-show="tweet.IsApprovedByHandle" class="fas fa-check fa-lg" style="vertical-align: middle;"></i>
                    </span>
                    <span>
                        <button type="button" ng-show="!tweet.IsPostedByWebJob && tweet.RetweetNum == 0" class="btn btn-primary btn-sm" ng-click="tweet.EditPaneExpanded = true">Edit</button>
                    </span>
                </div>

                <div ng-show="tweet.EditPaneExpanded">
                    <div class="input-group mb-3 mt-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="fab fa-twitter fa-lg twitter"></i>
                            </span>
                        </div>
                        <textarea class="form-control" rows="5" id="body-text" ng-model="tweet.StatusBody"></textarea>
                    </div>

                    <div class="d-flex w-100 justify-content-between">
                        <span>
                            <button type="button" class="btn btn-primary btn-sm" ng-click="editTweet(tweet, $index)">Save</button>
                        </span>
                        <span>
                            <i class="fas fa-compress fa-lg" ng-click="tweet.EditPaneExpanded = false"></i>
                        </span>
                    </div>

                    <div class="alert alert-danger mt-2" role="alert" ng-show="tweet.error">
                        <strong>Oops!</strong> Tweet body exceeds 280 character limit.
                    </div>
                </div>

                <div class="mt-2">
                    <i ng-show="tweet.IsPostedByWebJob && !tweet.EditPaneExpanded" class="fab fa-twitter-square fa-lg twitter"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="delete" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" ng-click="deleteAccount()">Yes</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>